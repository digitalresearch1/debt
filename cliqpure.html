function doPost(e) {
  try {
    const body = JSON.parse(e.postData.contents || "{}");

    // âœ… Put your Sheet ID + sheet name here
    const SHEET_ID = "REPLACE_WITH_YOUR_SHEET_ID";
    const TAB_NAME = "Responses";

    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sh = ss.getSheetByName(TAB_NAME) || ss.insertSheet(TAB_NAME);

    // Create header once
    if (sh.getLastRow() === 0) {
      sh.appendRow([
        "timestamp","transaction_id","hasDebt","totalDebt",
        "creditCards","personalLoans","medicalDebt","nonFederalStudentLoans",
        "autoLoan","collections","payday","otherUnsecured",
        "willing","called","ocrVerified",
        "reachedSpecialist","helpful","nextStepsExplained","comments"
      ]);
    }

    const d = body.debts || {};
    sh.appendRow([
      body.timestamp || new Date().toISOString(),
      body.transaction_id || "",
      body.hasDebt || "",
      body.totalDebt || 0,
      d.creditCards || 0,
      d.personalLoans || 0,
      d.medicalDebt || 0,
      d.nonFederalStudentLoans || 0,
      d.autoLoan || 0,
      d.collections || 0,
      d.payday || 0,
      d.otherUnsecured || 0,
      body.willing || "",
      body.called || "",
      body.ocrVerified ? "yes" : "no",
      body.feedback_reachedSpecialist || "",
      body.feedback_helpful || "",
      body.feedback_nextStepsExplained || "",
      body.feedback_comments || ""
    ]);

    return ContentService
      .createTextOutput(JSON.stringify({ ok: true }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ ok: false, error: String(err) }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

