<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>App Experience Research Study</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tesseract.js v6 -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@6/dist/tesseract.min.js"></script>

  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .card { border: 1px solid rgb(226 232 240); border-radius: 18px; }
    .mono { font-variant-numeric: tabular-nums; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
<main class="max-w-xl mx-auto px-4 py-10">

  <!-- MAIN -->
  <section class="card bg-white shadow-sm p-6 space-y-5">
    <div class="space-y-2">
      <p class="text-sm text-slate-600">App experience research study</p>
      <p class="text-lg font-semibold">Try TikTok for 30 seconds (no sign-up required)</p>
    </div>

    <!-- PURPOSE -->
    <div class="rounded-xl bg-slate-50 border border-slate-200 p-4 text-sm text-slate-700 space-y-2">
      <p class="font-semibold text-slate-900">Purpose of this study</p>
      <p>
        This is a short <strong>user-experience research study</strong> about
        <strong>first impressions of TikTok</strong> from people who have
        <strong>never used the app before</strong>.
        We’re interested in what new users notice in the first 30 seconds and
        what makes someone want to <strong>keep the app—or delete it</strong>.
      </p>
      <p>
        This is an <strong>independent study</strong>. We are <strong>not TikTok</strong>.
        No account is required and no personal information is collected.
      </p>
    </div>

    <!-- INSTRUCTIONS -->
    <div class="text-sm text-slate-700 space-y-2">
      <p class="font-semibold text-slate-900">What to do</p>
      <p>
        Click the button below to download TikTok. You’ll be taken to the App Store to install it.
        After installing, open the app and browse for <strong>30 seconds or more</strong>
        (<strong>no sign-up required</strong>). Spend about <strong>1 minute</strong> looking around,
        then return to this page to upload a screenshot of your <strong>home screen showing the TikTok app icon</strong>
        and continue.
      </p>
      <p class="text-xs text-slate-500">
        Tip: A clear home screen screenshot where the “TikTok” label is visible works best.
      </p>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <button id="btnOpen"
        class="rounded-xl px-4 py-3 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800">
        Click to Download
      </button>

      <button id="btnGoFeedback"
        class="rounded-xl px-4 py-3 text-sm font-semibold bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-40"
        disabled>
        Continue to feedback
      </button>
    </div>

    <p id="hint" class="text-xs text-slate-500"></p>

    <!-- SCREENSHOT + OCR -->
    <div class="rounded-xl border border-slate-200 bg-white p-4 space-y-3">
      <p class="text-sm font-semibold">Upload home screen screenshot (required)</p>
      <p class="text-xs text-slate-600">
        We unlock “Continue” only if we detect the word <strong>TikTok</strong> in the screenshot.
      </p>

      <input id="shot" type="file" accept="image/*" class="block w-full text-sm"/>

      <button id="btnOcr"
        class="rounded-xl px-4 py-3 text-sm font-semibold bg-slate-900 text-white disabled:opacity-40"
        disabled>
        Validate screenshot
      </button>

      <div>
        <span class="text-xs text-slate-600">OCR status</span>
        <span id="ocrPct" class="text-xs mono ml-2">0%</span>
        <div class="h-2 bg-slate-200 rounded mt-1">
          <div id="ocrBar" class="h-full bg-indigo-600" style="width:0%"></div>
        </div>
        <p id="ocrMsg" class="text-xs text-slate-600 mt-1"></p>
      </div>

      <p id="gateMsg" class="text-xs text-slate-500"></p>
    </div>
  </section>

  <!-- FEEDBACK -->
  <section id="feedback" class="card bg-white shadow-sm p-6 mt-6 space-y-4 hidden">
    <p class="text-lg font-semibold">Tell us about your experience</p>

    <p class="font-semibold">Would you keep TikTok installed?</p>
    <label><input type="radio" name="keep"> Yes</label><br>
    <label><input type="radio" name="keep"> No</label><br>
    <label><input type="radio" name="keep"> Not sure</label>

    <p class="font-semibold mt-3">Why or why not?</p>
    <textarea id="why" class="w-full border rounded p-2 text-sm" rows="3"></textarea>

    <button id="btnSubmit"
      class="w-full rounded-xl px-4 py-3 text-sm font-semibold bg-slate-900 text-white">
      Submit & finish
    </button>
  </section>

</main>

<script>
const OFFER_URL = "https://smrturl.co/a/scd13071c18/86?s1=test";
const COMPLETE_URL = "https://connect.cloudresearch.com/participant/project/B6BCAE82AF/complete";

let opened = false, verified = false;

const btnOpen = document.getElementById("btnOpen");
const btnOcr = document.getElementById("btnOcr");
const btnGo = document.getElementById("btnGoFeedback");
const shot = document.getElementById("shot");
const ocrMsg = document.getElementById("ocrMsg");
const gateMsg = document.getElementById("gateMsg");
const ocrBar = document.getElementById("ocrBar");
const ocrPct = document.getElementById("ocrPct");

btnOpen.onclick = () => {
  window.open(OFFER_URL, "_blank");
  opened = true;
  gateMsg.textContent = "Now upload your home screen screenshot.";
};

shot.onchange = () => btnOcr.disabled = false;

btnOcr.onclick = async () => {
  const file = shot.files[0];
  if (!file) return;

  const worker = await Tesseract.createWorker("eng");
  const { data } = await worker.recognize(file);
  await worker.terminate();

  const text = data.text.toLowerCase();
  ocrBar.style.width = "100%";
  ocrPct.textContent = "100%";

  if (text.includes("tiktok")) {
    verified = true;
    ocrMsg.textContent = "✅ TikTok detected. Continue unlocked.";
    btnGo.disabled = false;
  } else {
    ocrMsg.textContent = "❌ TikTok not detected. Please upload a clearer screenshot.";
  }
};

btnGo.onclick = () => {
  document.getElementById("feedback").classList.remove("hidden");
  document.getElementById("feedback").scrollIntoView({ behavior: "smooth" });
};

document.getElementById("btnSubmit").onclick = () => {
  window.location.href = COMPLETE_URL;
};
</script>

</body>
</html>

