<!DOCTYPE HTML>
<html lang="en" class="supernova">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1">
  <meta name="HandheldFriendly" content="true">
  <title>Financial Wellness Research Study</title>

  <!-- Fonts + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Brevo base styles -->
  <style>
    @font-face {
      font-display: block;
      font-family: Roboto;
      src: url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/7529907e9eaf8ebb5220c5f9850e3811.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/25c678feafdc175a70922a116c9be3e7.woff) format("woff");
    }
    @font-face {
      font-display: fallback;
      font-family: Roboto;
      font-weight: 600;
      src: url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/6e9caeeafb1f3491be3e32744bc30440.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/71501f0d8d5aa95960f6475d5487d4c2.woff) format("woff");
    }
    @font-face {
      font-display: fallback;
      font-family: Roboto;
      font-weight: 700;
      src: url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/3ef7cf158f310cf752d5ad08cd0e7e60.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/ece3a1d82f18b60bcce0211725c476aa.woff) format("woff");
    }

    #sib-container input::placeholder { text-align:left; font-family:Helvetica, sans-serif; color:#c0ccda; }
    #sib-container a { text-decoration: underline; color:#2BB2FC; }

    body { font-family:'Inter', sans-serif; background-color:#f3f4f6; }
    .form-all { box-shadow: 0 4px 20px rgba(15,23,42,0.1); }
    .form-header-group { background: linear-gradient(120deg, #4f46e5 0%, #6366f1 50%, #9333ea 100%); }

    .action-btn { transition: background-color 0.3s, transform 0.2s; cursor:pointer; }
    .action-btn:hover:not(.disabled-btn) { transform: translateY(-2px); }

    .disabled-btn { opacity:0.5; pointer-events:none; cursor:not-allowed; }

    .badge {
      display:inline-flex; align-items:center; gap:.4rem;
      border-radius:9999px; padding:.25rem .75rem;
      font-size:.75rem; font-weight:600;
    }
  </style>

  <link rel="stylesheet" href="https://sibforms.com/forms/end-form/build/sib-styles.css">
</head>

<body class="bg-gray-100 min-h-screen">

<div class="form-all w-full max-w-5xl mx-auto bg-white rounded-2xl p-4 md:p-8 my-6">

  <!-- HEADER -->
  <div class="form-header-group header-large mb-6 p-6 rounded-xl text-white text-center">
    <p class="badge bg-white/10 backdrop-blur text-xs md:text-sm justify-center mb-2">
      üîí Independent financial wellness research study
    </p>
    <h1 class="text-2xl md:text-3xl font-bold">Financial Wellness Research Study</h1>

    <p class="mt-2 text-sm md:text-base text-indigo-100">
      Please follow each step carefully. Only complete and verified participants are approved.
    </p>

    <!-- IMPORTANT DISCLAIMER -->
    <div class="mt-4 mx-auto max-w-3xl text-left bg-black/20 backdrop-blur rounded-xl p-4">
      <p class="text-xs md:text-sm text-indigo-50 leading-relaxed">
        <strong>Important:</strong> This is an <strong>independent research study</strong>. We are not the debt-relief company and we do not
        provide debt settlement services. You may be asked to complete a form on a <strong>third-party website</strong> to help us measure user experience.
      </p>
    </div>
  </div>

  <!-- PROGRESS BAR -->
  <div id="progressContainer" class="mb-6">
    <div class="flex items-center justify-between text-xs font-semibold text-slate-600 mb-2">
      <span id="progressLabel">Step 1 of 5</span>
    </div>
    <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
      <div id="progressBarFill" class="h-2 rounded-full bg-indigo-500" style="width:20%;"></div>
    </div>
    <div class="flex justify-between mt-1 text-[10px] text-slate-500 uppercase tracking-wide">
      <span>Who</span>
      <span>How</span>
      <span>Form</span>
      <span>Email</span>
      <span>Verify</span>
    </div>
  </div>

  <!-- STEP 1 -->
  <section id="step1" data-step="1" class="bg-slate-50 border border-slate-200 rounded-xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 1 ‚Äî Who can participate?
      </h2>
      <span class="text-xs text-slate-500">Start here</span>
    </div>

    <div class="mb-4 text-sm text-slate-700 space-y-3">
      <p>
        In this part of the study, we collect feedback from people who are actively looking
        for options to reduce or restructure their unsecured debt. Please continue only if:
      </p>
      <ul class="list-disc list-inside space-y-1">
        <li>You have significant unsecured debt (credit cards, personal loans, medical bills, etc.).</li>
        <li>Your total unsecured balances are typically above $15,000.</li>
        <li>You are genuinely interested in exploring solutions with a specialist.</li>
        <li>You are willing to receive a phone call at the number you provide on the next steps.</li>
      </ul>
    </div>

    <p class="mt-3 text-xs md:text-sm text-amber-800 flex items-center gap-2">
      <span>üìû</span>
      <span>A specialist from the provider you contact may call within <strong>24‚Äì48 hours</strong> after you submit their form.</span>
    </p>

    <div class="flex flex-wrap gap-3 mt-4">
      <button id="btnStep1Next"
              class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold text-sm px-5 py-2.5 rounded-full">
        Continue
      </button>
    </div>
  </section>

  <!-- STEP 2 -->
  <section id="step2" data-step="2" class="hidden bg-slate-50 border border-slate-200 rounded-xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 2 ‚Äî How to participate
      </h2>
      <span class="text-xs text-slate-500">Takes about 1 minute</span>
    </div>

    <div class="mb-4 text-sm text-slate-700 space-y-3">
      <ol class="list-decimal list-inside space-y-1">
        <li>
          Click <span class="font-semibold">‚ÄúOpen the form‚Äù</span> in the next step.
          A new tab will open to a <strong>third-party website</strong>.
        </li>
        <li>
          Complete the full form on that website. The questions are managed by that provider.
          <strong>You may be asked for your approximate debt amount, types of debt, name, email, phone number, and a few basic details.</strong>
        </li>
        <li>
          After submitting, you should see a confirmation or ‚Äúthank you‚Äù page on the provider‚Äôs site ‚Äî then return to this tab and click
          <span class="font-semibold">‚ÄúI completed the form‚Äù</span> to continue.
        </li>
        <li>
          Enter your email to receive follow-up messages tracking your experience.
        </li>
      </ol>

      <div class="mt-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4">
        <div class="flex items-start">
          <span class="text-blue-600 mr-3">üìß</span>
          <div>
            <p class="font-semibold text-gray-900 mb-1">About the Follow-up Emails</p>
            <p class="text-gray-700 text-sm">
              After you submit your email, we'll send a feedback request. You'll receive reminders for the next 3 days to update us on whether you received a call and if you got the help you needed.
            </p>
          </div>
        </div>
      </div>

      <p class="text-xs text-slate-500 mt-2">
        ‚è± The form typically takes about <strong>1 minute</strong> to complete.
      </p>
    </div>

    <div class="flex flex-wrap gap-3 mt-4">
      <button id="btnStep2Next"
              class="action-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold text-sm px-5 py-2.5 rounded-full">
        Continue
      </button>
    </div>
  </section>

  <!-- STEP 3 -->
  <section id="step3" data-step="3" class="hidden bg-slate-50 border border-slate-200 rounded-xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 3 ‚Äî Open the form (third-party website)
      </h2>
      <span class="text-xs text-slate-500">Required to continue</span>
    </div>

    <div class="mb-4 text-sm text-slate-700 space-y-3">
      <p>
        Click the button below to <strong>open the form</strong> in a new tab. Complete it on the third-party website,
        then return to this page.
      </p>

      <p class="text-xs text-slate-600">
        <strong>Note:</strong> The form you open belongs to a <strong>third-party provider</strong>. This research study is independent and does not
        represent the provider.
      </p>

      <p class="text-xs text-red-600 font-semibold">
        ‚ö†Ô∏è We will verify completion later. If it can‚Äôt be verified, participation can‚Äôt be approved.
      </p>
    </div>

    <div class="w-full max-w-xl bg-white border border-slate-200 rounded-xl shadow-sm p-4 mx-auto mb-3">
      <div class="flex flex-col items-center gap-2">
        <a id="offerLink"
           href="#"
           target="_blank"
           rel="noopener noreferrer"
           class="action-btn inline-flex items-center justify-center px-5 py-3 rounded-full bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700">
          Open the form
        </a>
        <p id="offerCountdownText" class="text-[11px] text-slate-500 text-center">
          After submitting the form in the new tab, come back here to confirm.
        </p>
      </div>
    </div>

    <div class="flex flex-wrap gap-3 mt-4">
      <button id="btnStep3Next"
              class="action-btn bg-emerald-600 hover:bg-emerald-700 text-white font-semibold text-sm px-5 py-2.5 rounded-full disabled-btn"
              disabled>
        I completed the form
      </button>
      <button id="btnStep3Exit"
              class="action-btn bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 font-medium text-xs px-4 py-2 rounded-full">
        I don't want to continue
      </button>
    </div>
  </section>

  <!-- STEP 4 -->
  <section id="step4" data-step="4" class="hidden bg-white border border-slate-200 rounded-xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 4 ‚Äî Email for research follow-up
      </h2>
      <span class="text-xs text-slate-500">Required to finish</span>
    </div>

    <p class="text-sm text-slate-600 mb-3">
      Your email is <strong>required</strong> so we can send a short follow-up about your experience.
      Once your email is saved, you will move to the final verification step.
    </p>

    <!-- Brevo embed -->
    <div id="brevoBlock" class="w-full mb-4">
      <div class="sib-form" style="text-align: center; background-color: #EFF2F7;">
        <div id="sib-form-container" class="sib-form-container">
          <div id="sib-container"
               class="sib-container--large sib-container--vertical"
               style="text-align:center; background-color:rgba(255,255,255,1); max-width:540px; border-radius:3px; border-width:1px; border-color:#C0CCD9; border-style:solid; margin:0 auto;">

            <iframe name="brevo_iframe" id="brevo_iframe" style="display:none;"></iframe>

            <form id="sib-form"
                  method="POST"
                  action="https://52bcaf92.sibforms.com/serve/MUIFAO5vlejSCs-rWtk8_hSGgyILb9Oi-aOLbS_zI5_FjrtRovBWkBZlGVuoCXxEbmOMZMrdo0ZllgcfYtt7jPnKOHgyHT2TYdf3Q-xFXArnK8ikp21kPr7-iXsfMeK4CtD4cAPf2oHHMJLw5OtgVzgyKMt0hXTJ3UiMJVGUXzHbWENuGdgb7j-x2xeZ6iW5f9ix4gocwCjOBdct"
                  target="brevo_iframe">

              <div style="padding: 8px 0;">
                <div class="sib-form-block"
                     style="font-size:18px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent;">
                  <p>Survey feedback reminder</p>
                </div>
              </div>

              <div style="padding: 4px 0%;">
                <div class="sib-form-block"
                     style="font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent;">
                  <div class="sib-text-form-block">
                    <p>Please provide your email so we can send you a reminder about this survey and your experience.</p>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0%;">
                <div class="sib-input sib-form-block">
                  <div class="form__entry entry_block">
                    <div class="form__label-row">
                      <label class="entry__label"
                             style="font-weight: 700; text-align:left; font-size:14px; font-family:Helvetica, sans-serif; color:#3c4858;"
                             for="EMAIL" data-required="*">
                        Enter your email address
                      </label>

                      <div class="entry__field">
                        <input class="input"
                               type="text"
                               id="EMAIL"
                               name="EMAIL"
                               autocomplete="off"
                               placeholder="EMAIL"
                               data-required="true"
                               required />
                      </div>
                    </div>

                    <label id="email_error"
                           class="entry__error entry__error--primary"
                           style="display:none; font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#661d1d; background-color:#ffeded; border-radius:3px; border-color:#ff4949; padding:4px 6px;">
                    </label>
                    <label class="entry__specification"
                           style="font-size:11px; text-align:left; font-family:Helvetica, sans-serif; color:#8390A4;">
                      Provide your email address. For example: abc@xyz.com
                    </label>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0%;">
                <div class="sib-optin sib-form-block">
                  <div class="form__entry entry_mcq">
                    <div class="form__label-row">
                      <div class="entry__choice">
                        <label style="display:flex; align-items:flex-start; gap:6px;">
                          <input type="checkbox"
                                 class="input_replaced"
                                 value="1"
                                 id="OPT_IN"
                                 name="OPT_IN" />
                          <span class="checkbox checkbox_tick_positive"></span>
                          <span style="font-size:12px; text-align:left; font-family:Helvetica, sans-serif; color:#3C4858;">
                            I agree to receive your email and accept the data privacy statement.
                          </span>
                        </label>
                      </div>
                    </div>
                    <label id="optin_error"
                           class="entry__error entry__error--primary"
                           style="display:none; font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#661d1d; background-color:#ffeded; border-radius:3px; border-color:#ff4949; padding:4px 6px;">
                    </label>
                    <label class="entry__specification"
                           style="font-size:11px; text-align:left; font-family:Helvetica, sans-serif; color:#8390A4;">
                      You may unsubscribe at any time using the link in our emails.
                    </label>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0%;">
                <div class="sib-form-block" style="text-align: left">
                  <button id="brevoSubmitBtn"
                          class="sib-form-block__button sib-form-block__button-with-loader"
                          style="font-size:14px; text-align:center; font-weight:700; font-family:Helvetica, sans-serif; color:#FFFFFF; background-color:#3E4857; border-radius:9999px; border-width:0px; width:100%; padding:8px 0;"
                          type="submit">
                    SUBMIT
                  </button>
                </div>
              </div>

              <input type="text" name="email_address_check" value="" class="input--hidden">
              <input type="hidden" name="locale" value="en">
              <input type="hidden" name="html_type" value="simple">
            </form>
          </div>
        </div>
      </div>
    </div>

    <button id="btnStep4Exit"
            class="action-btn bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 font-medium text-xs px-4 py-2 rounded-full">
      I don't want to continue
    </button>
  </section>

  <!-- STEP 5 -->
  <section id="step5" data-step="5" class="hidden bg-amber-50 border border-amber-200 rounded-xl p-4 md:p-5">
    <h2 class="text-lg md:text-xl font-semibold text-amber-900 mb-2">
      Step 5 ‚Äî Final verification and return to panel
    </h2>
    <p class="text-sm text-amber-800 mb-3">
      After you start this step, we will verify your form and email submission with our verification system.
      This usually takes under a minute. Please do not refresh or close the page until you are redirected
      back to the panel.
    </p>

    <button id="btnStartVerification"
            class="action-btn bg-amber-600 hover:bg-amber-700 text-white font-semibold text-sm px-5 py-2.5 rounded-full">
      Start final verification
    </button>

    <p id="waitText" class="text-sm text-amber-900 font-semibold mt-3 hidden"></p>
  </section>

</div>

<script>
  function smoothScrollTo(el) {
    if (!el) return;
    const rect = el.getBoundingClientRect();
    const absoluteY = rect.top + window.scrollY - 80;
    window.scrollTo({ top: absoluteY, behavior: 'smooth' });
  }

  const urlParams = new URLSearchParams(window.location.search);
  let transactionId =
    urlParams.get('RID') ||
    urlParams.get('participant_id') ||
    urlParams.get('transaction_id');

  if (!transactionId) {
    transactionId = 'tx_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
  }

  // --- URLs ---
  const completionUrl  = `https://notch.insights.supply/cb?token=c9212f78-5226-4e99-bd51-29845ea96d16&RID=${encodeURIComponent(transactionId)}`;
  const terminationUrl = `https://samplicio.us/s/ClientCallBack.aspx?RIS=20&RID=${encodeURIComponent(transactionId)}`;

  const offerBaseUrl    = 'https://trkmcl.com/wy8odpg43k/p98vjj0e83';
  const offerTrackedUrl = `${offerBaseUrl}${offerBaseUrl.includes('?') ? '&' : '?'}subid=${encodeURIComponent(transactionId)}`;

  // Worker verification endpoint (must return JSON: { submitted: true/false })
  const verifyFormUrl = `https://marketcall2.kayembakasongo.workers.dev/verify-form?transaction_id=${encodeURIComponent(transactionId)}`;

  const progressFill  = document.getElementById('progressBarFill');
  const progressLabel = document.getElementById('progressLabel');
  const stepSections  = document.querySelectorAll('section[data-step]');

  const btnStep1Next  = document.getElementById('btnStep1Next');
  const btnStep2Next  = document.getElementById('btnStep2Next');

  const offerLink          = document.getElementById('offerLink');
  const offerCountdownText = document.getElementById('offerCountdownText');
  const btnStep3Next       = document.getElementById('btnStep3Next');
  const btnStep3Exit       = document.getElementById('btnStep3Exit');

  const brevoBlock     = document.getElementById('brevoBlock');
  const sibForm        = document.getElementById('sib-form');
  const emailInput     = document.getElementById('EMAIL');
  const optIn          = document.getElementById('OPT_IN');
  const emailErr       = document.getElementById('email_error');
  const optinErr       = document.getElementById('optin_error');
  const brevoSubmitBtn = document.getElementById('brevoSubmitBtn');
  const btnStep4Exit   = document.getElementById('btnStep4Exit');

  const btnStartVerification = document.getElementById('btnStartVerification');
  const waitText             = document.getElementById('waitText');

  // step state
  let currentStep = 1;

  // Session gating (client-side only)
  const offerKey = 'offer_opened_' + transactionId;
  const delayKey = 'offer_delay_done_' + transactionId;

  function updateProgress(step) {
    const pct = Math.min(100, Math.max(0, (step / 5) * 100));
    if (progressFill) progressFill.style.width = pct + '%';
    if (progressLabel) progressLabel.textContent = 'Step ' + step + ' of 5';
  }

  function showStep(step) {
    currentStep = step;
    stepSections.forEach(sec => {
      const secStep = parseInt(sec.getAttribute('data-step'), 10);
      sec.classList.toggle('hidden', secStep !== step);
    });
    updateProgress(step);
    const active = document.querySelector('section[data-step="' + step + '"]');
    smoothScrollTo(active);
  }

  function goToStep(step) {
    // Hard gate: steps 4 & 5 require offer opened + short delay done
    if (step >= 4) {
      const opened  = sessionStorage.getItem(offerKey) === '1';
      const delayed = sessionStorage.getItem(delayKey) === '1';
      if (!opened || !delayed) {
        alert('Please open and complete the form before continuing.');
        showStep(3);
        return;
      }
    }
    showStep(step);
  }

  function startOfferDelay() {
    if (!offerCountdownText || !btnStep3Next) return;

    if (sessionStorage.getItem(delayKey) === '1') {
      btnStep3Next.disabled = false;
      btnStep3Next.classList.remove('disabled-btn', 'bg-slate-300');
      btnStep3Next.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
      offerCountdownText.textContent = 'If you submitted the form, click ‚ÄúI completed the form‚Äù to continue.';
      return;
    }

    let seconds = 15;
    btnStep3Next.disabled = true;
    btnStep3Next.classList.add('disabled-btn', 'bg-slate-300');
    btnStep3Next.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
    offerCountdownText.textContent = 'Please complete the form in the new tab. You can confirm here in about ' + seconds + ' seconds...';

    const interval = setInterval(() => {
      seconds--;
      if (seconds <= 0) {
        clearInterval(interval);
        sessionStorage.setItem(delayKey, '1');
        btnStep3Next.disabled = false;
        btnStep3Next.classList.remove('disabled-btn', 'bg-slate-300');
        btnStep3Next.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
        offerCountdownText.textContent = 'If you submitted the form, click ‚ÄúI completed the form‚Äù to continue.';
      } else {
        offerCountdownText.textContent = 'Please complete the form in the new tab. You can confirm here in ' + seconds + ' seconds...';
      }
    }, 1000);
  }

  // Init
  if (offerLink) offerLink.href = offerTrackedUrl;
  showStep(1);

  // Restore gate if already done
  const alreadyOpened  = sessionStorage.getItem(offerKey) === '1';
  const alreadyDelayed = sessionStorage.getItem(delayKey) === '1';
  if (alreadyOpened && alreadyDelayed && btnStep3Next && offerCountdownText) {
    btnStep3Next.disabled = false;
    btnStep3Next.classList.remove('disabled-btn', 'bg-slate-300');
    btnStep3Next.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
    offerCountdownText.textContent = 'If you submitted the form, click ‚ÄúI completed the form‚Äù to continue.';
  }

  // Step nav
  if (btnStep1Next) btnStep1Next.addEventListener('click', () => goToStep(2));
  if (btnStep2Next) btnStep2Next.addEventListener('click', () => goToStep(3));

  // Step 3: open offer
  if (offerLink) {
    offerLink.addEventListener('click', function() {
      if (!sessionStorage.getItem(offerKey)) sessionStorage.setItem(offerKey, '1');
      startOfferDelay();
    });
  }

  // Step 3: confirm (client-side gate only; real verification is step 5 via Worker)
  if (btnStep3Next) {
    btnStep3Next.addEventListener('click', function() {
      const opened  = sessionStorage.getItem(offerKey) === '1';
      const delayed = sessionStorage.getItem(delayKey) === '1';
      if (!opened || !delayed) {
        alert('Please open and complete the form before continuing.');
        return;
      }
      goToStep(4);
    });
  }

  // Exit buttons -> termination
  if (btnStep3Exit) btnStep3Exit.addEventListener('click', () => window.location.href = terminationUrl);
  if (btnStep4Exit) btnStep4Exit.addEventListener('click', () => window.location.href = terminationUrl);

  // Step 4: Brevo validation -> move to step 5
  if (sibForm) {
    sibForm.addEventListener('submit', function(e) {
      let hasError = false;
      if (emailErr)  emailErr.style.display = 'none';
      if (optinErr)  optinErr.style.display = 'none';

      const emailVal = (emailInput && emailInput.value ? emailInput.value : '').trim();

      if (!emailVal) {
        hasError = true;
        if (emailErr) { emailErr.textContent = 'Please enter your email address.'; emailErr.style.display = 'block'; }
      } else if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailVal)) {
        hasError = true;
        if (emailErr) { emailErr.textContent = 'Please enter a valid email address.'; emailErr.style.display = 'block'; }
      }

      if (!optIn || !optIn.checked) {
        hasError = true;
        if (optinErr) { optinErr.textContent = 'Please agree to the privacy statement to continue.'; optinErr.style.display = 'block'; }
      }

      if (hasError) { e.preventDefault(); return; }

      if (brevoSubmitBtn) { brevoSubmitBtn.disabled = true; brevoSubmitBtn.textContent = 'Submitting...'; }

      // allow Brevo to post in background, then step 5
      setTimeout(function() {
        if (brevoBlock) brevoBlock.classList.add('hidden');
        goToStep(5);
      }, 3000);
    });
  }

  // Step 5: Worker verification -> redirect
  if (btnStartVerification) {
    btnStartVerification.addEventListener('click', async function() {
      btnStartVerification.disabled = true;
      btnStartVerification.classList.add('disabled-btn');

      if (waitText) {
        waitText.classList.remove('hidden');
        waitText.textContent = 'Checking your submission...';
      }

      try {
        const resp = await fetch(verifyFormUrl, { method: 'GET' });
        const data = await resp.json();
        window.location.href = (data && data.submitted) ? completionUrl : terminationUrl;
      } catch (err) {
        window.location.href = terminationUrl;
      }
    });
  }
</script>

</body>
</html>
