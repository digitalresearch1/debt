<!DOCTYPE HTML>
<html lang="en" class="supernova">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1">
  <meta name="HandheldFriendly" content="true">
  <title>Financial Wellness Research Study</title>

  <!-- Fonts + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Brevo base styles -->
  <style>
    @font-face {
      font-display: block;
      font-family: Roboto;
      src: url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/7529907e9eaf8ebb5220c5f9850e3811.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/25c678feafdc175a70922a116c9be3e7.woff) format("woff");
    }

    @font-face {
      font-display: fallback;
      font-family: Roboto;
      font-weight: 600;
      src: url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/6e9caeeafb1f3491be3e32744bc30440.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/71501f0d8d5aa95960f6475d5487d4c2.woff) format("woff");
    }

    @font-face {
      font-display: fallback;
      font-family: Roboto;
      font-weight: 700;
      src: url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/3ef7cf158f310cf752d5ad08cd0e7e60.woff2) format("woff2"),
           url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/ece3a1d82f18b60bcce0211725c476aa.woff) format("woff");
    }

    #sib-container input::placeholder {
      text-align: left;
      font-family: Helvetica, sans-serif;
      color: #c0ccda;
    }

    #sib-container a {
      text-decoration: underline;
      color: #2BB2FC;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }

    .form-all {
      box-shadow: 0 4px 20px rgba(15,23,42,0.1);
    }

    .form-header-group {
      background: linear-gradient(120deg, #4f46e5 0%, #6366f1 50%, #9333ea 100%);
    }

    .action-btn {
      transition: background-color 0.3s, transform 0.2s;
      cursor: pointer;
    }
    .action-btn:hover:not(.disabled-btn) {
      transform: translateY(-2px);
    }

    .disabled-btn {
      opacity: 0.5;
      pointer-events: none;
      cursor: not-allowed;
    }

    .video-wrapper {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 20px 40px rgba(15,23,42,0.35);
      border-radius: 0.75rem;
      overflow: hidden;
      background: #000;
    }
    .video-wrapper iframe {
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
    }

    @media (max-width: 768px) {
      .video-wrapper { height: 220px; }
    }
    @media (min-width: 769px) {
      .video-wrapper { height: 380px; }
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      border-radius: 9999px;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
  </style>

  <link rel="stylesheet" href="https://sibforms.com/forms/end-form/build/sib-styles.css">
</head>
<body class="bg-gray-100 min-h-screen">

<div class="form-all w-full max-w-5xl mx-auto bg-white rounded-2xl p-4 md:p-8 my-6">
  <!-- HEADER -->
  <div class="form-header-group header-large mb-6 p-6 rounded-xl text-white text-center">
    <p class="badge bg-white/10 backdrop-blur text-xs md:text-sm justify-center mb-2">
      üîí Private financial wellness study
    </p>
    <h1 class="text-2xl md:text-3xl font-bold">Financial Wellness Research Study</h1>
    <p class="mt-2 text-sm md:text-base text-indigo-100">
      3 quick steps. Only complete and verified participants are approved.
    </p>
  </div>

  <!-- STEP 1: OPEN OFFER FORM + SHORT EXPLANATION -->
  <section id="step1" class="mb-6 bg-slate-50 border border-slate-200 rounded-xl p-4 md:p-5">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 1 ‚Äî Open the secure financial form
      </h2>
      <span class="text-xs text-slate-500">Start here</span>
    </div>

    <div class="mb-4 text-sm text-slate-700 space-y-3">
      <div>
        <h3 class="font-semibold text-slate-900 mb-1">Who should continue?</h3>
        <ul class="list-disc list-inside space-y-1">
          <li>You have around <strong>$15,000+</strong> in unsecured debt (cards, loans, medical, etc.).</li>
          <li>You want real help and are okay with a specialist calling you.</li>
        </ul>
      </div>

      <div>
        <h3 class="font-semibold text-slate-900 mb-1">What you need to do</h3>
        <ol class="list-decimal list-inside space-y-1">
          <li>Click <strong>‚ÄúOpen secure financial form‚Äù</strong> below (new tab).</li>
          <li>Complete and submit the full form with accurate details.</li>
          <li>Return here and click <strong>‚ÄúI completed the form‚Äù</strong>.</li>
        </ol>
      </div>
    </div>

    <div class="w-full max-w-xl bg-white border border-slate-200 rounded-xl shadow-sm p-4 mx-auto mb-3">
      <p class="text-xs text-slate-700 mb-3 text-center">
        Click below to open the secure form in a new tab. Fill it honestly, then come back here.<br>
        <strong>Important:</strong> If you see ‚ÄúWhere did you hear about this program?‚Äù please select
        <span class="font-semibold underline">Facebook</span> so your answers match this study.<br>
        <span class="font-semibold text-red-600">
          ‚ö†Ô∏è We automatically check if the form was submitted. If not, your participation will NOT be approved.
        </span>
      </p>
      <div class="flex flex-col items-center gap-2">
        <a id="offerLink"
           href="#"
           target="_blank"
           rel="noopener noreferrer"
           class="action-btn inline-flex items-center justify-center px-5 py-3 rounded-full bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700">
          Open secure financial form
        </a>
        <p class="text-[11px] text-slate-500 text-center">
          After you submit the form, come back and click
          <strong>‚ÄúI completed the form‚Äù</strong>.
        </p>
      </div>
    </div>

    <div class="flex flex-wrap gap-3">
      <button id="btnFormDone"
              class="action-btn bg-emerald-600 hover:bg-emerald-700 text-white font-semibold text-sm px-5 py-2.5 rounded-full disabled-btn"
              disabled>
        I completed the form
      </button>
      <button id="btnFormQuit"
              class="action-btn bg-red-50 hover:bg-red-100 text-red-700 border border-red-200 font-medium text-xs px-4 py-2 rounded-full">
        I don't want to continue
      </button>
    </div>
  </section>

  <!-- STEP 2: VIDEO -->
  <section id="step2" class="mb-6 bg-white border border-slate-200 rounded-xl p-4 md:p-5 opacity-40">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 2 ‚Äî Watch a short explainer video
      </h2>
      <span class="text-xs text-slate-500">Unlocked after Step 1</span>
    </div>

    <p class="text-sm text-slate-600 mb-3">
      Please watch this short Facebook video about how the program works. The button below will unlock after a brief delay.
    </p>

    <div class="video-wrapper mb-3">
      <iframe
        src="https://www.facebook.com/plugins/video.php?height=314&href=https%3A%2F%2Fwww.facebook.com%2Freel%2F1205740158030889%2F&show_text=true&width=860&t=0"
        style="border:none; overflow:hidden;" scrolling="no" frameborder="0"
        allowfullscreen="true"
        allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
      </iframe>
    </div>

    <p id="videoHint" class="text-[11px] text-slate-600 mb-3">
      This step will unlock after you click ‚ÄúI completed the form‚Äù in Step 1.
    </p>

    <button id="btnVideoNext"
            class="action-btn disabled-btn bg-slate-300 text-white font-semibold text-sm px-5 py-2.5 rounded-full"
            disabled>
      I watched the video
    </button>
  </section>

  <!-- STEP 3: BREVO EMAIL GATE -->
  <section id="step3" class="mb-6 bg-white border border-slate-200 rounded-xl p-4 md:p-5 opacity-40">
    <div class="flex items-center justify-between mb-2">
      <h2 class="text-lg md:text-xl font-semibold text-slate-900">
        Step 3 ‚Äî Email for follow-up
      </h2>
      <span class="text-xs text-slate-500">Unlocked after video</span>
    </div>

    <p class="text-sm text-slate-600 mb-3">
      Your email is <strong>required</strong> so we can send you a reminder and summary of your options.
      Once it is saved, the green button to finish will unlock.
    </p>

    <!-- Brevo embed -->
    <div id="brevoBlock" class="w-full mb-4">
      <div class="sib-form" style="text-align: center; background-color: #EFF2F7;">
        <div id="sib-form-container" class="sib-form-container">
          <div id="sib-container"
               class="sib-container--large sib-container--vertical"
               style="text-align:center; background-color:rgba(255,255,255,1); max-width:540px; border-radius:3px; border-width:1px; border-color:#C0CCD9; border-style:solid; margin:0 auto;">

            <!-- Hidden iframe so the form posts to Brevo without leaving this page -->
            <iframe name="brevo_iframe" id="brevo_iframe" style="display:none;"></iframe>

            <form id="sib-form"
                  method="POST"
                  action="https://52bcaf92.sibforms.com/serve/MUIFAO5vlejSCs-rWtk8_hSGgyILb9Oi-aOLbS_zI5_FjrtRovBWkBZlGVuoCXxEbmOMZMrdo0ZllgcfYtt7jPnKOHgyHT2TYdf3Q-xFXArnK8ikp21kPr7-iXsfMeK4CtD4cAPf2oHHMJLw5OtgVzgyKMt0hXTJ3UiMJVGUXzHbWENuGdgb7j-x2xeZ6iW5f9ix4gocwCjOBdct"
                  target="brevo_iframe">

              <div style="padding: 8px 0;">
                <div class="sib-form-block"
                     style="font-size:18px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent;">
                  <p>Survey feedback reminder</p>
                </div>
              </div>

              <div style="padding: 4px 0;">
                <div class="sib-form-block"
                     style="font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent;">
                  <div class="sib-text-form-block">
                    <p>Please provide your email so we can send you a reminder and the outcome of your request.</p>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0;">
                <div class="sib-input sib-form-block">
                  <div class="form__entry entry_block">
                    <div class="form__label-row">
                      <label class="entry__label"
                             style="font-weight: 700; text-align:left; font-size:14px; font-family:Helvetica, sans-serif; color:#3c4858;"
                             for="EMAIL" data-required="*">
                        Enter your email address
                      </label>

                      <div class="entry__field">
                        <input class="input"
                               type="text"
                               id="EMAIL"
                               name="EMAIL"
                               autocomplete="off"
                               placeholder="EMAIL"
                               data-required="true"
                               required />
                      </div>
                    </div>

                    <label id="email_error"
                           class="entry__error entry__error--primary"
                           style="display:none; font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#661d1d; background-color:#ffeded; border-radius:3px; border-color:#ff4949; padding:4px 6px;">
                    </label>
                    <label class="entry__specification"
                           style="font-size:11px; text-align:left; font-family:Helvetica, sans-serif; color:#8390A4;">
                      Example: abc@xyz.com
                    </label>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0;">
                <div class="sib-optin sib-form-block">
                  <div class="form__entry entry_mcq">
                    <div class="form__label-row">
                      <div class="entry__choice">
                        <label style="display:flex; align-items:flex-start; gap:6px;">
                          <input type="checkbox"
                                 class="input_replaced"
                                 value="1"
                                 id="OPT_IN"
                                 name="OPT_IN" />
                          <span class="checkbox checkbox_tick_positive"></span>
                          <span style="font-size:12px; text-align:left; font-family:Helvetica, sans-serif; color:#3C4858;">
                            I agree to receive your email and accept the data privacy statement.
                          </span>
                        </label>
                      </div>
                    </div>
                    <label id="optin_error"
                           class="entry__error entry__error--primary"
                           style="display:none; font-size:13px; text-align:left; font-family:Helvetica, sans-serif; color:#661d1d; background-color:#ffeded; border-radius:3px; border-color:#ff4949; padding:4px 6px;">
                    </label>
                    <label class="entry__specification"
                           style="font-size:11px; text-align:left; font-family:Helvetica, sans-serif; color:#8390A4;">
                      You can unsubscribe at any time using the link in our emails.
                    </label>
                  </div>
                </div>
              </div>

              <div style="padding: 8px 0%;">
                <div class="sib-form-block" style="text-align: left">
                  <button id="brevoSubmitBtn"
                          class="sib-form-block__button sib-form-block__button-with-loader"
                          style="font-size:14px; text-align:center; font-weight:700; font-family:Helvetica, sans-serif; color:#FFFFFF; background-color:#3E4857; border-radius:9999px; border-width:0px; width:100%; padding:8px 0;"
                          type="submit">
                    SUBMIT
                  </button>
                </div>
              </div>

              <input type="text" name="email_address_check" value="" class="input--hidden">
              <input type="hidden" name="locale" value="en">
              <input type="hidden" name="html_type" value="simple">
            </form>
          </div>
        </div>
      </div>
    </div>

    <button id="btnContinueFinish"
            class="action-btn w-full md:w-auto px-6 py-2.5 rounded-full bg-slate-400 text-white font-semibold text-sm disabled-btn cursor-not-allowed"
            disabled>
      Continue to final verification
    </button>
  </section>

  <!-- STEP 4: FINAL WAIT + REDIRECT -->
  <section id="step4" class="bg-amber-50 border border-amber-200 rounded-xl p-4 md:p-5 opacity-40">
    <h2 class="text-lg md:text-xl font-semibold text-amber-900 mb-2">
      Step 4 ‚Äî Final verification
    </h2>
    <p class="text-sm text-amber-800 mb-3">
      After you click the button above, we will verify your form and email with our partner system.
      This usually takes under a minute. Please do not refresh or close the page until you are redirected.
    </p>

    <p id="waitText" class="text-sm text-amber-900 font-semibold hidden"></p>
  </section>
</div>

<script>
  // Helper: smooth scroll
  function smoothScrollTo(el) {
    if (!el) return;
    const rect = el.getBoundingClientRect();
    const absoluteY = rect.top + window.scrollY - 80;
    window.scrollTo({ top: absoluteY, behavior: 'smooth' });
  }

  // Get transaction_id / RID
  const urlParams = new URLSearchParams(window.location.search);
  let transactionId = urlParams.get('transaction_id') || urlParams.get('RID');

  const src = 'ps';

  if (!transactionId) {
    transactionId =
      'tx_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
  }

  // URLs
  const psScreenoutUrl =
    'https://spectrumsurveys.com/surveydone?st=18&transaction_id=' +
    encodeURIComponent(transactionId);

  const offerBaseUrl = 'https://trkmcl.com/wy8odpg43k/p98vjj0e83';
  const offerTrackedUrl =
    offerBaseUrl +
    (offerBaseUrl.includes('?') ? '&' : '?') +
    'subid=' +
    encodeURIComponent(transactionId);

  const workerFinishUrl =
    'https://marketcall1.kayembakasongo.workers.dev/finish' +
    '?transaction_id=' +
    encodeURIComponent(transactionId) +
    '&src=' +
    encodeURIComponent(src);

  // DOM elements
  const offerLink = document.getElementById('offerLink');
  const btnFormDone = document.getElementById('btnFormDone');
  const btnFormQuit = document.getElementById('btnFormQuit');

  const step2 = document.getElementById('step2');
  const btnVideoNext = document.getElementById('btnVideoNext');
  const videoHint = document.getElementById('videoHint');

  const step3 = document.getElementById('step3');
  const brevoBlock = document.getElementById('brevoBlock');
  const btnContinueFinish = document.getElementById('btnContinueFinish');

  const step4 = document.getElementById('step4');
  const waitText = document.getElementById('waitText');

  const sibForm = document.getElementById('sib-form');
  const emailInput = document.getElementById('EMAIL');
  const optIn = document.getElementById('OPT_IN');
  const emailErr = document.getElementById('email_error');
  const optinErr = document.getElementById('optin_error');
  const brevoSubmitBtn = document.getElementById('brevoSubmitBtn');

  // Set offer link href safely
  if (offerLink) {
    offerLink.href = offerTrackedUrl;

    offerLink.addEventListener('click', function () {
      // Enable "I completed the form"
      if (btnFormDone) {
        btnFormDone.classList.remove('disabled-btn');
        btnFormDone.disabled = false;
      }
    });
  }

  // Quit button
  if (btnFormQuit) {
    btnFormQuit.addEventListener('click', function () {
      window.location.href = psScreenoutUrl;
    });
  }

  // After they say they completed the form, unlock video step with timer
  if (btnFormDone) {
    btnFormDone.addEventListener('click', function () {
      if (btnFormDone.classList.contains('disabled-btn')) return;

      if (step2) step2.style.opacity = '1';
      smoothScrollTo(step2);

      if (!btnVideoNext || !videoHint) return;

      let waitSeconds = 40;
      const originalLabel = 'I watched the video';

      btnVideoNext.disabled = true;
      btnVideoNext.classList.add('disabled-btn');
      btnVideoNext.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
      btnVideoNext.classList.add('bg-slate-300');
      btnVideoNext.textContent = originalLabel + ' (' + waitSeconds + 's)';
      videoHint.textContent =
        'Please watch the Facebook video. The button below will unlock after a short delay.';

      const interval = setInterval(function () {
        waitSeconds--;
        if (waitSeconds <= 0) {
          clearInterval(interval);
          btnVideoNext.disabled = false;
          btnVideoNext.classList.remove('disabled-btn', 'bg-slate-300');
          btnVideoNext.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
          btnVideoNext.textContent = originalLabel;
          videoHint.textContent =
            '‚úÖ You can now continue. If you haven\'t already, please make sure you watched the Facebook video so the call makes sense.';
        } else {
          btnVideoNext.textContent = originalLabel + ' (' + waitSeconds + 's)';
        }
      }, 1000);
    });
  }

  // After video, unlock email step
  if (btnVideoNext) {
    btnVideoNext.addEventListener('click', function () {
      if (btnVideoNext.disabled) return;

      if (step3) step3.style.opacity = '1';
      if (emailInput) emailInput.disabled = false;
      if (optIn) optIn.disabled = false;
      if (brevoSubmitBtn) brevoSubmitBtn.disabled = false;

      smoothScrollTo(step3);
    });
  }

  // Brevo email submit
  if (sibForm) {
    sibForm.addEventListener('submit', function (e) {
      let hasError = false;
      if (emailErr) emailErr.style.display = 'none';
      if (optinErr) optinErr.style.display = 'none';

      const emailVal = (emailInput && emailInput.value ? emailInput.value : '').trim();

      if (!emailVal) {
        hasError = true;
        if (emailErr) {
          emailErr.textContent = 'Please enter your email address.';
          emailErr.style.display = 'block';
        }
      } else if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailVal)) {
        hasError = true;
        if (emailErr) {
          emailErr.textContent = 'Please enter a valid email address.';
          emailErr.style.display = 'block';
        }
      }

      if (!optIn || !optIn.checked) {
        hasError = true;
        if (optinErr) {
          optinErr.textContent = 'Please agree to the privacy statement to continue.';
          optinErr.style.display = 'block';
        }
      }

      if (hasError) {
        e.preventDefault();
        return;
      }

      if (brevoSubmitBtn) {
        brevoSubmitBtn.disabled = true;
        brevoSubmitBtn.textContent = 'Submitting...';
      }

      setTimeout(function () {
        if (brevoBlock) brevoBlock.classList.add('hidden');
        if (btnContinueFinish) {
          btnContinueFinish.disabled = false;
          btnContinueFinish.classList.remove('disabled-btn', 'bg-slate-400', 'cursor-not-allowed');
          btnContinueFinish.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
          btnContinueFinish.textContent = 'Continue to final verification';
        }
        if (step4) step4.style.opacity = '1';
      }, 3500);
    });
  }

  // Final verification
  if (btnContinueFinish) {
    btnContinueFinish.addEventListener('click', function () {
      if (btnContinueFinish.disabled) return;

      if (waitText) {
        waitText.classList.remove('hidden');
        let seconds = 60;
        waitText.textContent =
          'Checking your submission with our partner system... 60 seconds remaining.';
        smoothScrollTo(step4);

        const interval = setInterval(function () {
          seconds--;
          if (seconds <= 0) {
            clearInterval(interval);
            waitText.textContent = 'Done! Redirecting you back to the panel...';
            setTimeout(function () {
              window.location.href = workerFinishUrl;
            }, 800);
          } else {
            waitText.textContent =
              'Checking your submission with our partner system... ' +
              seconds +
              ' seconds remaining.';
          }
        }, 1000);
      } else {
        // Fallback: just redirect
        window.location.href = workerFinishUrl;
      }
    });
  }
</script>

</body>
</html>
