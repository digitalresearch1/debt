<!DOCTYPE HTML>
<html lang="en" class="supernova">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1">
  <meta name="HandheldFriendly" content="true">
  <title>Financial Wellness Research Study</title>

  <!-- Fonts + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eef2ff',
              100: '#e0e7ff',
              200: '#c7d2fe',
              300: '#a5b4fc',
              400: '#818cf8',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81',
            }
          },
          boxShadow: {
            soft: '0 24px 60px rgba(15, 23, 42, 0.18)',
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, #4f46e5 0, #020617 55%);
      min-height: 100vh;
    }

    .form-container {
      background: white;
      border-radius: 24px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.28);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .header-gradient {
      background: radial-gradient(circle at top left, #6366f1, #4f46e5 40%, #a855f7 100%);
    }

    .step-card {
      background: white;
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      transition: all 0.25s ease;
    }

    .step-card.active {
      border-color: #4f46e5;
      box-shadow: 0 16px 40px rgba(79, 70, 229, 0.12);
    }

    .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .primary-btn {
      background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
      color: white;
      transition: all 0.25s ease;
    }

    .primary-btn:hover {
      background: linear-gradient(135deg, #4338ca 0%, #4f46e5 100%);
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(79, 70, 229, 0.45);
    }

    .warning-box {
      background: #fff7ed;
      border: 1px solid #fed7aa;
      border-radius: 14px;
    }

    .info-box {
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      border-radius: 14px;
    }

    .eligibility-box {
      background: #fefce8;
      border: 1px solid #facc15;
      border-radius: 14px;
    }

    .feature-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.45rem 0.9rem;
      background: #eef2ff;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
      color: #4338ca;
    }

    .reminder-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.45rem 0.9rem;
      background: #ecfeff;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
      color: #0369a1;
    }

    .email-preview {
      background: #0f172a;
      border-radius: 14px;
      padding: 1.25rem 1.5rem;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      line-height: 1.6;
      color: #e5e7eb;
      border: 1px solid #1f2937;
    }

    .completion-card {
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      border: 2px solid #22c55e;
      border-radius: 18px;
    }

    .iframe-skeleton {
      background: repeating-linear-gradient(
        45deg,
        #f1f5f9,
        #f1f5f9 10px,
        #e2e8f0 10px,
        #e2e8f0 20px
      );
    }

    .video-wrapper {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      box-shadow: 0 20px 40px rgba(15,23,42,0.35);
      border-radius: 0.75rem;
      overflow: hidden;
      background: #000;
    }

    .video-wrapper iframe {
      width: 100%;
      height: 100%;
      display: block;
      border: 0;
    }

    @media (max-width: 768px) {
      .video-wrapper { height: 220px; }
    }
    @media (min-width: 769px) {
      .video-wrapper { height: 360px; }
    }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

<div class="form-container w-full max-w-5xl p-4 md:p-8 lg:p-10">
  
  <!-- HEADER -->
  <div class="header-gradient rounded-2xl p-6 md:p-8 text-white mb-8">
    <div class="flex flex-wrap items-center justify-between gap-4 mb-5">
      <div>
        <div class="inline-flex items-center gap-2 bg-black/20 backdrop-blur px-4 py-1.5 rounded-full text-xs md:text-sm font-medium">
          <span>üîí</span>
          <span>Confidential Financial Wellness Research</span>
        </div>
        <h1 class="mt-3 text-2xl md:text-3xl lg:text-4xl font-semibold tracking-tight">
          Financial Wellness Research Study
        </h1>
      </div>
      <div class="text-right text-xs md:text-sm text-indigo-100 space-y-1">
        <p>Study Type: <span class="font-semibold">Debt Relief Experience</span></p>
        <p>Estimated Time: <span class="font-semibold">5‚Äì8 minutes</span></p>
      </div>
    </div>
    <p class="text-sm md:text-base text-indigo-100/90 max-w-3xl">
      You‚Äôll be asked to complete a secure debt-relief form and then share feedback on your experience.
      Please follow each step carefully. Only complete and verified participants are approved.
    </p>
  </div>

  <!-- STEP 1 -->
  <div class="step-card active p-5 md:p-6 lg:p-7 mb-6">
    <div class="flex items-start gap-3 md:gap-4 mb-5">
      <div class="step-number">1</div>
      <div class="flex-1">
        <div class="flex flex-wrap items-center justify-between gap-3 mb-1.5">
          <h2 class="text-lg md:text-xl lg:text-2xl font-semibold text-slate-900">
            Open & Complete the Secure Financial Form
          </h2>
          <span class="text-xs md:text-sm font-medium text-primary-700 bg-primary-50 px-3 py-1 rounded-full">
            Start here
          </span>
        </div>
        <p class="text-sm md:text-base text-slate-600">
          This step connects you with a real debt specialist for balances of <span class="font-semibold">$15,000+</span> in unsecured debt.
        </p>
      </div>
    </div>

    <!-- Who Can Participate -->
    <div class="eligibility-box p-4 md:p-5 mb-5">
      <h3 class="font-semibold text-slate-900 mb-2 text-sm md:text-base">Who should continue?</h3>
      <ul class="space-y-1.5 text-xs md:text-sm text-slate-700">
        <li class="flex gap-2">
          <span class="mt-0.5 text-amber-500">‚Ä¢</span>
          <span>You have <strong>unsecured debt</strong> (credit cards, personal loans, medical bills, etc.).</span>
        </li>
        <li class="flex gap-2">
          <span class="mt-0.5 text-amber-500">‚Ä¢</span>
          <span>Your <strong>total unsecured balances are typically above $15,000</strong>.</span>
        </li>
        <li class="flex gap-2">
          <span class="mt-0.5 text-amber-500">‚Ä¢</span>
          <span>You are <strong>seriously interested</strong> in exploring debt reduction options.</span>
        </li>
        <li class="flex gap-2">
          <span class="mt-0.5 text-amber-500">‚Ä¢</span>
          <span>You are willing to <strong>receive a phone call</strong> at the number you provide.</span>
        </li>
      </ul>
      <p class="mt-3 text-xs md:text-sm text-amber-800 flex items-center gap-2">
        <span>üìû</span>
        <span>A financial specialist will typically call within <strong>24‚Äì48 hours</strong> after you submit the form.</span>
      </p>
    </div>

    <!-- How To Participate -->
    <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4 md:p-5 mb-5">
      <h3 class="font-semibold text-slate-900 mb-3 text-sm md:text-base">How this step works</h3>
      <ol class="space-y-2 text-xs md:text-sm text-slate-700">
        <li class="flex gap-2">
          <span class="font-semibold text-primary-700">1.</span>
          <span>Click <strong>‚ÄúStart secure form‚Äù</strong> below. This records your click and reveals the embedded form.</span>
        </li>
        <li class="flex gap-2">
          <span class="font-semibold text-primary-700">2.</span>
          <span>Complete the secure form with accurate contact and debt details.</span>
        </li>
        <li class="flex gap-2">
          <span class="font-semibold text-primary-700">3.</span>
          <span>After submitting, return to this section and click <strong>‚ÄúI submitted the form‚Äù</strong>.</span>
        </li>
        <li class="flex gap-2">
          <span class="font-semibold text-primary-700">4.</span>
          <span>After verification, you will unlock the email step and a short Facebook explainer video.</span>
        </li>
      </ol>

      <div class="mt-4 info-box p-3.5 md:p-4">
        <div class="flex items-start gap-2.5">
          <span class="mt-0.5 text-blue-600">üìß</span>
          <p class="text-xs md:text-sm text-slate-800">
            After your form is submitted, we send follow-up emails for the next 3 days to understand if the specialist called and whether you received helpful support.
          </p>
        </div>
      </div>

      <div class="mt-3 warning-box p-3.5 md:p-4">
        <div class="flex items-start gap-2.5">
          <span class="mt-0.5 text-amber-600">‚ö†Ô∏è</span>
          <p class="text-xs md:text-sm text-slate-800">
            We automatically verify whether the secure form was submitted. If the form is not found as submitted, your participation cannot be approved.
          </p>
        </div>
      </div>
    </div>

    <!-- FORM OPENING BUTTON -->
    <div class="mb-5 text-center">
      <a id="directFormLink"
         href="#"
         class="primary-btn inline-flex items-center justify-center px-8 py-3.5 rounded-xl text-sm md:text-base font-semibold w-full md:w-auto">
        <span class="mr-2.5">üöÄ</span>
        Start secure form
        <span class="ml-2.5 text-xs">Begin</span>
      </a>
      <p class="mt-2 text-[11px] md:text-xs text-slate-500">
        The secure form will appear below on this page after you click the button.
      </p>
    </div>

    <!-- INLINE WEBFUSE IFRAME (HIDDEN UNTIL CLICK) -->
    <div id="webfuseContainer" class="mt-4 hidden">
      <div class="flex items-center justify-between mb-2">
        <p class="text-xs md:text-sm font-medium text-slate-800">
          Secure financial form
        </p>
        <p id="formStatus" class="text-[11px] md:text-xs text-slate-500">
          Click ‚ÄúStart secure form‚Äù so we can record your click, then complete the form below.
        </p>
      </div>
      <div class="w-full h-[650px] md:h-[780px] rounded-2xl overflow-hidden border border-slate-200 bg-white iframe-skeleton">
        <iframe
          id="webfuseFrame"
          src="https://webfuse.com/+cliq/"
          class="w-full h-full border-0"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
        ></iframe>
      </div>
    </div>

    <!-- FACEBOOK VIDEO (HIDDEN UNTIL FORM VERIFIED) -->
    <div id="facebookContainer" class="mt-6 hidden">
      <div class="flex items-center justify-between mb-2">
        <p class="text-xs md:text-sm font-medium text-slate-800">
          Short explainer video
        </p>
        <p class="text-[11px] md:text-xs text-slate-500">
          Watch this 30‚Äì60 second overview after submitting the secure form.
        </p>
      </div>
      <div class="video-wrapper">
        <iframe
          src="https://www.facebook.com/plugins/video.php?height=314&href=https%3A%2F%2Fwww.facebook.com%2Freel%2F1205740158030889%2F&show_text=true&width=860&t=0"
          style="border:none; overflow:hidden;" scrolling="no" frameborder="0"
          allowfullscreen="true"
          allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share">
        </iframe>
      </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="flex flex-wrap gap-3 mt-5">
      <button id="btnFormDone"
              class="px-6 py-3 bg-slate-100 text-slate-400 text-sm md:text-base font-semibold rounded-xl cursor-not-allowed"
              disabled>
        <span class="mr-2">‚è≥</span>
        I submitted the form
      </button>
      <button id="btnFormQuit"
              class="px-5 py-3 bg-slate-50 hover:bg-slate-100 text-slate-700 text-sm md:text-base font-medium rounded-xl border border-slate-200 transition">
        I don't meet the requirements
      </button>
    </div>

    <!-- FEATURE BADGES -->
    <div class="flex flex-wrap gap-2 mt-5">
      <span class="feature-badge">
        <span>üìû</span> Live specialist call
      </span>
      <span class="feature-badge">
        <span>üí∞</span> $15,000+ unsecured debt
      </span>
      <span class="reminder-badge">
        <span>üìß</span> 3-day follow-up
      </span>
      <span class="feature-badge">
        <span>‚è±Ô∏è</span> 24‚Äì48h response
      </span>
    </div>
  </div>

  <!-- STEP 2: EMAIL -->
  <div class="step-card p-5 md:p-6 lg:p-7 mb-6 opacity-60">
    <div class="flex items-start gap-3 md:gap-4 mb-4">
      <div class="step-number">2</div>
      <div class="flex-1">
        <div class="flex items-center justify-between flex-wrap gap-2 mb-1.5">
          <h2 class="text-lg md:text-xl lg:text-2xl font-semibold text-slate-900">
            Provide Email for Follow-up
          </h2>
          <span class="text-xs md:text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
            Unlocks after Step 1
          </span>
        </div>
        <p class="text-xs md:text-sm text-slate-600">
          We‚Äôll send feedback requests and short reminders about your experience with the debt specialist.
        </p>
      </div>
    </div>

    <div id="emailSection" class="hidden">
      <div class="info-box p-4 md:p-5 mb-5">
        <h3 class="font-semibold text-slate-900 mb-2 text-sm md:text-base">What you‚Äôll receive</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 text-xs md:text-sm text-slate-700">
          <div class="bg-white rounded-xl border border-slate-200 p-3.5">
            <div class="text-2xl mb-2">üìß</div>
            <p class="font-semibold mb-1">Immediate email</p>
            <p>Sent right after you provide your email here.</p>
          </div>
          <div class="bg-white rounded-xl border border-slate-200 p-3.5">
            <div class="text-2xl mb-2">‚è∞</div>
            <p class="font-semibold mb-1">Day 1 reminder</p>
            <p>A short check-in about the call and your experience.</p>
          </div>
          <div class="bg-white rounded-xl border border-slate-200 p-3.5">
            <div class="text-2xl mb-2">üîÑ</div>
            <p class="font-semibold mb-1">Day 2‚Äì3 reminders</p>
            <p>Optional follow-up if you haven‚Äôt replied yet.</p>
          </div>
        </div>
      </div>

      <div class="email-preview mb-5">
        <strong>From:</strong> Financial Wellness Research Team<br>
        <strong>To:</strong> <span id="previewEmail">[your email]</span><br>
        <strong>Subject:</strong> Did the financial specialist call you?<br><br>

        Hi [Name],<br><br>
        Thank you for submitting your information for our debt reduction research study.<br><br>
        A financial specialist should call you within 24‚Äì48 hours to discuss options for your $15,000+ debt.<br><br>
        We‚Äôd like to know:<br>
        1. Have you received a call from the specialist yet?<br>
        2. If yes, did you receive the help you were looking for?<br><br>
        Please reply to this email with your feedback. You‚Äôll receive reminders for the next 3 days to update us on your experience.<br><br>
        Best regards,<br>
        Financial Wellness Research Team
      </div>

      <div class="flex flex-col md:flex-row gap-4 items-start mb-5">
        <div class="flex-1 w-full">
          <label class="block text-xs md:text-sm font-medium text-slate-800 mb-2">
            Email address for follow-up
          </label>
          <input type="email"
                 id="userEmail"
                 placeholder="you@example.com"
                 class="w-full px-4 py-3 border border-slate-300 rounded-xl text-sm md:text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
          <p class="mt-2 text-[11px] md:text-xs text-slate-500">
            We use this only to send research follow-up emails about your experience.
          </p>
        </div>
        <button id="btnSendEmail"
                class="primary-btn px-6 py-3 rounded-xl font-semibold text-sm md:text-base mt-1">
          Start follow-up emails
        </button>
      </div>

      <div id="emailScheduled" class="hidden">
        <div class="completion-card p-5 md:p-6 text-center">
          <div class="text-4xl mb-3">üìß</div>
          <h3 class="text-lg md:text-xl font-semibold text-slate-900 mb-1.5">Emails Scheduled</h3>
          <p class="text-xs md:text-sm text-slate-700 mb-4">
            Your first feedback email has been sent and reminders are scheduled for the next 3 days.
          </p>
          <button id="btnCompleteStudy"
                  class="primary-btn px-6 py-3 rounded-xl font-semibold text-sm md:text-base">
            Complete study
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 3: COMPLETION -->
  <div class="step-card p-5 md:p-6 lg:p-7 opacity-60">
    <div class="flex items-start gap-3 md:gap-4 mb-3">
      <div class="step-number">3</div>
      <div class="flex-1">
        <div class="flex items-center justify-between flex-wrap gap-2 mb-1.5">
          <h2 class="text-lg md:text-xl lg:text-2xl font-semibold text-slate-900">
            Confirm Study Completion
          </h2>
          <span class="text-xs md:text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
            Unlocks after email setup
          </span>
        </div>
        <p class="text-xs md:text-sm text-slate-600">
          This final step sends you back to the research platform so your participation can be recorded.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  // --- Transaction ID ---
  const urlParams = new URLSearchParams(window.location.search);
  let transactionId = urlParams.get('transaction_id') || urlParams.get('RID');
  const src = 'ps';

  if (!transactionId) {
    transactionId = 'tx_' + Date.now().toString(36) + Math.random().toString(36).substring(2);
  }

  // --- URLs ---
  const completionUrl = `https://notch.insights.supply/cb?token=c9212f78-5226-4e99-bd51-29845ea96d16&RID=${encodeURIComponent(transactionId)}`;
  const terminationUrl = `https://samplicio.us/s/ClientCallBack.aspx?RIS=20&RID=${encodeURIComponent(transactionId)}`;

  // Your affiliate click URL (used as a tracking pixel when they click)
  const offerBaseUrl = 'https://trkmcl.com/wy8odpg43k/p98vjj0e83';
  const offerTrackedUrl = `${offerBaseUrl}${offerBaseUrl.includes('?') ? '&' : '?'}subid=${encodeURIComponent(transactionId)}`;

  // Email endpoints
  const sendEmailUrl = `https://marketcall2.kayembakasongo.workers.dev/send-email?transaction_id=${encodeURIComponent(transactionId)}`;
  const scheduleRemindersUrl = `https://marketcall2.kayembakasongo.workers.dev/schedule-reminders?transaction_id=${encodeURIComponent(transactionId)}`;
  const verifyFormUrl = `https://marketcall2.kayembakasongo.workers.dev/verify-form?transaction_id=${encodeURIComponent(transactionId)}`;

  // --- DOM Elements ---
  const directFormLink = document.getElementById('directFormLink');
  const btnFormDone = document.getElementById('btnFormDone');
  const btnFormQuit = document.getElementById('btnFormQuit');
  const webfuseFrame = document.getElementById('webfuseFrame');
  const webfuseContainer = document.getElementById('webfuseContainer');
  const facebookContainer = document.getElementById('facebookContainer');
  const formStatus = document.getElementById('formStatus');

  const stepCards = document.querySelectorAll('.step-card');
  const step2 = stepCards[1];
  const step3 = stepCards[2];

  const emailSection = document.getElementById('emailSection');
  const emailScheduled = document.getElementById('emailScheduled');
  const btnSendEmail = document.getElementById('btnSendEmail');
  const userEmail = document.getElementById('userEmail');
  const previewEmail = document.getElementById('previewEmail');
  const btnCompleteStudy = document.getElementById('btnCompleteStudy');

  // --- Helpers ---
  function enableFormCompletion() {
    if (!btnFormDone) return;
    btnFormDone.disabled = false;
    btnFormDone.classList.remove('bg-slate-100', 'text-slate-400', 'cursor-not-allowed');
    btnFormDone.classList.add('primary-btn', 'text-white');
    btnFormDone.innerHTML = '<span class="mr-2">üìã</span> I submitted the form';
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  // --- Update email preview ---
  if (userEmail && previewEmail) {
    userEmail.addEventListener('input', function () {
      previewEmail.textContent = this.value || '[your email]';
    });
  }

  // --- Click handler: fire click + reveal iframe ---
  if (directFormLink) {
    directFormLink.addEventListener('click', function (e) {
      e.preventDefault();

      // 1) Fire affiliate click via tracking pixel
      try {
        const tracker = new Image();
        tracker.src = offerTrackedUrl + (offerTrackedUrl.includes('?') ? '&' : '?') + 'ts=' + Date.now();
      } catch (err) {
        console.error('Tracking pixel error:', err);
      }

      // 2) Show the embedded form
      if (webfuseContainer) {
        webfuseContainer.classList.remove('hidden');
      }

      // 3) Update status + scroll to iframe
      if (formStatus) {
        formStatus.textContent = 'Click recorded. Please complete and submit the secure form below.';
        formStatus.classList.remove('text-slate-500');
        formStatus.classList.add('text-emerald-700');
      }

      if (webfuseFrame) {
        setTimeout(() => {
          webfuseFrame.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 200);
      }

      // 4) Enable "I submitted the form" button
      enableFormCompletion();
    });
  }

  // --- Verify form submission ---
  if (btnFormDone) {
    btnFormDone.addEventListener('click', async function () {
      if (btnFormDone.disabled) return;

      btnFormDone.disabled = true;
      btnFormDone.innerHTML = '<span class="mr-2">‚è≥</span> Verifying submission...';

      try {
        const verifyResponse = await fetch(verifyFormUrl, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });

        const verification = await verifyResponse.json();

        if (verification.submitted) {
          btnFormDone.classList.remove('primary-btn');
          btnFormDone.classList.add('bg-emerald-100', 'text-emerald-800');
          btnFormDone.innerHTML = '<span class="mr-2">‚úÖ</span> Form verified';

          // Show Facebook video after form verification
          if (facebookContainer) {
            facebookContainer.classList.remove('hidden');
          }

          // Unlock Step 2
          if (step2) {
            step2.style.opacity = '1';
            step2.classList.add('active');
          }
          if (emailSection) {
            emailSection.classList.remove('hidden');
          }

          setTimeout(() => {
            step2?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 400);
        } else {
          btnFormDone.disabled = false;
          btnFormDone.classList.remove('primary-btn');
          btnFormDone.classList.add('bg-red-100', 'text-red-800');
          btnFormDone.innerHTML = '<span class="mr-2">‚ùå</span> Form not found';

          alert('We could not verify your form submission. Please make sure you completed and submitted the secure form, then try again.');

          setTimeout(() => {
            btnFormDone.disabled = false;
            btnFormDone.classList.remove('bg-red-100', 'text-red-800');
            btnFormDone.classList.add('primary-btn', 'text-white');
            btnFormDone.innerHTML = '<span class="mr-2">üìã</span> I submitted the form';
          }, 3000);
        }
      } catch (error) {
        console.error('Error verifying form:', error);
        btnFormDone.disabled = false;
        btnFormDone.classList.remove('primary-btn');
        btnFormDone.classList.add('bg-amber-100', 'text-amber-800');
        btnFormDone.innerHTML = '<span class="mr-2">‚ö†Ô∏è</span> Check connection';

        setTimeout(() => {
          btnFormDone.disabled = false;
          btnFormDone.classList.remove('bg-amber-100', 'text-amber-800');
          btnFormDone.classList.add('primary-btn', 'text-white');
          btnFormDone.innerHTML = '<span class="mr-2">üìã</span> I submitted the form';
        }, 3000);
      }
    });
  }

  // --- Email + reminders ---
  if (btnSendEmail) {
    btnSendEmail.addEventListener('click', async function () {
      const email = userEmail.value.trim();

      if (!email) {
        alert('Please enter your email address to receive follow-up reminders.');
        userEmail.focus();
        return;
      }

      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        userEmail.focus();
        return;
      }

      btnSendEmail.disabled = true;
      btnSendEmail.innerHTML = 'Scheduling emails‚Ä¶';

      try {
        await fetch(sendEmailUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email,
            type: 'immediate',
            transaction_id: transactionId
          })
        });

        await fetch(scheduleRemindersUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email,
            transaction_id: transactionId,
            days: 3
          })
        });

        if (emailScheduled) {
          emailScheduled.classList.remove('hidden');
          setTimeout(() => {
            emailScheduled.scrollIntoView({ behavior: 'smooth', block: 'center' });

            if (step3) {
              step3.style.opacity = '1';
              step3.classList.add('active');
            }
          }, 300);
        }

        btnSendEmail.innerHTML = '‚úÖ Emails scheduled';
        btnSendEmail.classList.add('bg-emerald-100', 'text-emerald-800');
      } catch (error) {
        console.error('Error scheduling emails:', error);
        btnSendEmail.innerHTML = '‚ùå Error ‚Äì try again';
        btnSendEmail.disabled = false;
        alert('There was an error scheduling your emails. Please try again.');
      }
    });
  }

  // --- Complete study ---
  if (btnCompleteStudy) {
    btnCompleteStudy.addEventListener('click', function () {
      if (confirm('Thank you for participating! Your follow-up emails have been scheduled. You can now complete the study.')) {
        window.location.href = completionUrl;
      }
    });
  }

  // --- Quit button ---
  if (btnFormQuit) {
    btnFormQuit.addEventListener('click', function () {
      if (confirm("If you don't have $15,000+ in unsecured debt or cannot receive a specialist call, you may exit the study. Continue?")) {
        window.location.href = terminationUrl;
      }
    });
  }
</script>

</body>
</html>


