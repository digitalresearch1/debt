<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neck Pain Research Survey</title>
  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:18px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#0f172a;
    }
    .wrap{
      width:100%; max-width:880px; background:#fff; border-radius:20px; overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.28);
    }
    .head{
      padding:26px 22px; text-align:center; color:#fff;
      background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%);
    }
    .badge{
      display:inline-block; padding:7px 16px; border-radius:999px;
      font-weight:800; font-size:12px; background:#10b981; margin-bottom:10px;
      box-shadow:0 4px 14px rgba(16,185,129,.35);
    }
    .head h1{margin:0; font-size:24px; line-height:1.2}
    .head p{margin:10px 0 0; opacity:.92; font-size:14px}
    .content{padding:22px}
    .bar{height:7px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin-bottom:18px}
    .fill{height:100%; width:0%; background:linear-gradient(90deg,#4f46e5,#7c3aed); transition:width .35s ease}

    .step{display:none; animation:fade .3s ease}
    .step.active{display:block}
    .q{font-size:20px; font-weight:750; margin:8px 0 14px; color:#111827; line-height:1.35}
    .hint{font-size:13px; color:#64748b; margin-top:-6px; margin-bottom:14px}

    .opts{display:grid; gap:12px; margin-top:14px}
    .opt{
      border:2px solid #e5e7eb; border-radius:14px; padding:14px 14px;
      display:flex; gap:12px; align-items:flex-start; cursor:pointer;
      transition:all .18s ease; background:#fff;
    }
    .opt:hover{border-color:#4f46e5; background:#f5f3ff}
    .opt.selected{border-color:#4f46e5; background:#f5f3ff}
    .opt input{margin-top:3px; transform:scale(1.1)}
    .opt label{cursor:pointer; font-size:16px; color:#1f2937; line-height:1.35; flex:1}

    .nav{display:flex; gap:12px; margin-top:18px;}
    .btn{
      border:0; border-radius:12px; padding:12px 16px; font-weight:800; cursor:pointer; font-size:15px;
      transition:transform .12s ease, box-shadow .12s ease;
      width:100%;
    }
    .btn:active{transform:translateY(1px)}
    .btn.next{
      background:linear-gradient(135deg,#4f46e5,#7c3aed); color:#fff; box-shadow:0 10px 25px rgba(79,70,229,.25)
    }
    .btn.next:hover{box-shadow:0 14px 34px rgba(79,70,229,.34)}
    .ctr{font-size:13px; color:#64748b; font-weight:700; text-align:center; margin-top:10px}

    .gift-offer {
      text-align:center;
      padding: 20px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: 15px;
      margin-top: 10px;
      border: 3px solid #0ea5e9;
    }
    .gift-offer h2 { color:#0369a1; margin:0 0 10px; font-size:22px; }
    .gift-offer p { color:#475569; margin:0 0 12px; font-size:15px; line-height:1.5; }
    .shipping-note{
      background:#dcfce7; border:2px solid #22c55e; border-radius:10px;
      padding:12px; margin:12px 0; color:#166534; font-weight:700; font-size:14px;
    }
    .note{
      margin-top:12px; font-size:12px; color:#6b7280; line-height:1.45; background:#f8fafc;
      border-left:4px solid #94a3b8; border-radius:10px; padding:12px;
    }

    /* ✅ Make iframe taller */
    .iframeWrap{
      margin-top:14px; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden;
      height:160vh; background:#fff;
    }
    iframe{width:100%; height:100%; border:0}

    @keyframes fade{from{opacity:0; transform:translateY(10px)}to{opacity:1; transform:translateY(0)}}

    @media (max-width:560px){
      .content{padding:16px}
      .q{font-size:18px}
      .iframeWrap{height:85vh}
      .btn{font-size:14px}
    }
  </style>
</head>
<body>

<script>
  // Your affiliate offer
  const OFFER_URL = "https://mwebzova.com/9178/879/2/?";

  // ✅ Read transaction_id from the incoming URL
  function getTid() {
    const u = new URL(window.location.href);
    return u.searchParams.get("transaction_id") || u.searchParams.get("tid") || u.searchParams.get("tx") || "";
  }

  // ✅ Build PureSpectrum end links dynamically
  function completeUrl() {
    const tid = encodeURIComponent(getTid());
    return "https://spectrumsurveys.com/surveydone?st=21&transaction_id=" + tid;
  }
  function disqualifyUrl() {
    const tid = encodeURIComponent(getTid());
    return "https://spectrumsurveys.com/surveydone?st=18&transaction_id=" + tid;
  }

  function goTop(url){
    try { window.top.location.href = url; }
    catch(e){ window.location.href = url; }
  }
</script>

<div class="wrap">
  <div class="head">
    <div class="badge">RESEARCH SURVEY</div>
    <h1>Neck Pain & Discomfort Study</h1>
    <p>Please answer a few questions. If you qualify, you may view an optional offer (shipping applies).</p>
  </div>

  <div class="content">
    <div class="bar"><div class="fill" id="fill"></div></div>

    <!-- STEP 1 -->
    <section class="step active" id="s1">
      <div class="q">How often do you experience neck pain or stiffness?</div>
      <div class="opts" data-type="radio" data-name="freq">
        <div class="opt" data-value="daily"><input type="radio" name="freq"/><label>Daily or almost daily</label></div>
        <div class="opt" data-value="weekly"><input type="radio" name="freq"/><label>Several times a week</label></div>
        <div class="opt" data-value="monthly"><input type="radio" name="freq"/><label>A few times a month</label></div>
        <div class="opt" data-value="rarely"><input type="radio" name="freq"/><label>Rarely / occasionally</label></div>
        <div class="opt" data-value="never"><input type="radio" name="freq"/><label>Never</label></div>
      </div>
      <div class="nav">
        <button class="btn next" type="button" onclick="next()">Next</button>
      </div>
      <div class="ctr" id="ctr1"></div>
    </section>

    <!-- STEP 2 -->
    <section class="step" id="s2">
      <div class="q">Where do you feel discomfort most often?</div>
      <div class="opts" data-type="radio" data-name="where">
        <div class="opt" data-value="neck"><input type="radio" name="where"/><label>Neck area</label></div>
        <div class="opt" data-value="shoulders"><input type="radio" name="where"/><label>Neck + shoulders</label></div>
        <div class="opt" data-value="upperback"><input type="radio" name="where"/><label>Neck + upper back</label></div>
        <div class="opt" data-value="headaches"><input type="radio" name="where"/><label>Headaches caused by neck tension</label></div>
      </div>
      <div class="nav">
        <button class="btn next" type="button" onclick="next()">Next</button>
      </div>
      <div class="ctr" id="ctr2"></div>
    </section>

    <!-- STEP 3 -->
    <section class="step" id="s3">
      <div class="q">Which activities tend to make it worse? (Select at least one)</div>
      <div class="hint">You can pick multiple.</div>
      <div class="opts" data-type="check" data-name="triggers">
        <div class="opt" data-value="phone"><input type="checkbox"/><label>Looking down at a phone / device</label></div>
        <div class="opt" data-value="desk"><input type="checkbox"/><label>Desk work / computer use</label></div>
        <div class="opt" data-value="sleep"><input type="checkbox"/><label>Sleeping position / pillow</label></div>
        <div class="opt" data-value="driving"><input type="checkbox"/><label>Driving / long commuting</label></div>
        <div class="opt" data-value="stress"><input type="checkbox"/><label>Stress / tension</label></div>
      </div>
      <div class="nav">
        <button class="btn next" type="button" onclick="next()">Next</button>
      </div>
      <div class="ctr" id="ctr3"></div>
    </section>

    <!-- STEP 4 -->
    <section class="step" id="s4">
      <div class="q">Have you tried anything to relieve neck pain?</div>
      <div class="opts" data-type="radio" data-name="tried">
        <div class="opt" data-value="yes_many"><input type="radio" name="tried"/><label>Yes — several methods/products</label></div>
        <div class="opt" data-value="yes_some"><input type="radio" name="tried"/><label>Yes — a few things</label></div>
        <div class="opt" data-value="no"><input type="radio" name="tried"/><label>No — not yet</label></div>
      </div>
      <div class="nav">
        <button class="btn next" type="button" onclick="next()">Next</button>
      </div>
      <div class="ctr" id="ctr4"></div>
    </section>

    <!-- STEP 5 -->
    <section class="step" id="s5">
      <div class="q">Are you 18 years or older?</div>
      <div class="opts" data-type="radio" data-name="age18">
        <div class="opt" data-value="yes"><input type="radio" name="age18"/><label>Yes</label></div>
        <div class="opt" data-value="no"><input type="radio" name="age18"/><label>No</label></div>
      </div>
      <div class="nav">
        <button class="btn next" type="button" onclick="next()">Continue</button>
      </div>
      <div class="ctr" id="ctr5"></div>
    </section>

    <!-- STEP 6 -->
    <section class="step" id="s6">
      <div class="gift-offer">
        <h2>Optional Offer (Qualified)</h2>
        <p>You qualify. Below is an optional offer page you may view.</p>

        <div class="shipping-note">
          Shipping & handling applies (the merchant displays final costs at checkout).
        </div>

        <div class="iframeWrap">
          <iframe
            src="https://mwebzova.com/9178/879/2/?"
            loading="eager"
            referrerpolicy="no-referrer"
            allow="payment *; clipboard-read; clipboard-write">
          </iframe>
        </div>

        <button class="btn next" type="button" onclick="complete()" style="margin-top:14px;">
          Finish Survey
        </button>

        <div class="note">
          “Finish Survey” sends you back to PureSpectrum to record completion.
        </div>
      </div>
    </section>

  </div>
</div>

<script>
  const steps = ["s1","s2","s3","s4","s5","s6"];
  let idx = 0;
  const answers = {};

  // option cards
  document.querySelectorAll(".opts").forEach(group => {
    const type = group.dataset.type;
    const name = group.dataset.name;

    group.querySelectorAll(".opt").forEach(opt => {
      opt.addEventListener("click", () => {
        if (type === "radio") {
          group.querySelectorAll(".opt").forEach(o => {
            o.classList.remove("selected");
            const inp = o.querySelector("input");
            if (inp) inp.checked = false;
          });
          opt.classList.add("selected");
          const inp = opt.querySelector("input");
          if (inp) inp.checked = true;
          answers[name] = opt.dataset.value;
        } else {
          const inp = opt.querySelector("input");
          const on = !(inp && inp.checked);
          if (inp) inp.checked = on;
          opt.classList.toggle("selected", on);
          answers[name] = Array.from(group.querySelectorAll(".opt.selected")).map(o => o.dataset.value);
        }
      });
    });
  });

  function show(i){
    idx = i;
    steps.forEach((id,n)=>document.getElementById(id).classList.toggle("active", n===idx));
    document.getElementById("fill").style.width = ((idx/(steps.length-1))*100) + "%";
    const ctr = document.getElementById("ctr" + (idx+1));
    if (ctr) ctr.textContent = `Step ${idx+1} of ${steps.length}`;
  }

  function validateCurrent(){
    const step = document.getElementById(steps[idx]);
    const group = step.querySelector(".opts");
    if (!group) return true;

    const type = group.dataset.type;
    const name = group.dataset.name;

    if (type === "radio") {
      if (!answers[name]) { alert("Please select an option to continue."); return false; }

      // ✅ Screenouts (Terminate):
      if (name === "freq" && (answers[name] === "rarely" || answers[name] === "never")) {
        disqualify("Not enough neck pain frequency");
        return false;
      }
      if (name === "age18" && answers[name] === "no") {
        disqualify("Under 18");
        return false;
      }
      return true;
    } else {
      if (!Array.isArray(answers[name]) || answers[name].length === 0) {
        alert("Please select at least one option to continue.");
        return false;
      }
      return true;
    }
  }

  function next(){
    if (!validateCurrent()) return;
    if (idx < steps.length-1) show(idx+1);
  }

  function complete(){
    if (!getTid()) {
      alert("Missing transaction_id in the URL. PureSpectrum must open this survey with a transaction_id parameter.");
      return;
    }
    try { localStorage.setItem("neck_survey_responses", JSON.stringify(answers)); } catch(e){}
    goTop(completeUrl());
  }

  function disqualify(reason){
    if (!getTid()) {
      alert("Missing transaction_id in the URL. PureSpectrum must open this survey with a transaction_id parameter.");
      return;
    }
    try {
      answers._dq_reason = reason || "disqualified";
      localStorage.setItem("neck_survey_responses", JSON.stringify(answers));
    } catch(e){}
    goTop(disqualifyUrl());
  }

  show(0);
</script>

</body>
</html>
